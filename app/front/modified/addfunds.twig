{% include 'header1.twig' %}

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

<style>
/* =====================
   BASE / MOBILE FIRST
===================== */
body {
  background: #f6f8fb;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  color: #1f2937;
}

h4 {
  font-size: 15px;
  font-weight: 600;
  margin-bottom: 10px;
}

.container-fluid {
  padding: 12px;
}

/* =====================
   CARDS
===================== */
.card {
  background: #fff;
  border-radius: 14px;
  padding: 16px;
  box-shadow: 0 10px 25px rgba(0,0,0,.06);
  margin-bottom: 16px;
}

/* =====================
   STATS
===================== */
.stats {
  display: grid;
  grid-template-columns: 1fr;
  gap: 12px;
}

.stat-item {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.stat-item span {
  font-size: 13px;
  color: #6b7280;
}

.stat-item strong {
  font-size: 20px;
}

/* =====================
   TABS
===================== */
.nav-tabs {
  display: flex;
  gap: 8px;
  border: none;
}

.nav-tabs li a {
  border-radius: 999px;
  padding: 8px 14px;
  background: #f1f5f9;
  color: #111;
  font-size: 13px;
}

.nav-tabs li.active a {
  background: #2563eb;
  color: #fff;
}

/* =====================
   FORMS
===================== */
label {
  font-size: 13px;
  margin-bottom: 4px;
}

input, select {
  width: 100%;
  height: 42px;
  border-radius: 10px;
  border: 1px solid #e5e7eb;
  padding: 0 12px;
}

button {
  background: #2563eb;
  color: #fff;
  border: none;
  border-radius: 10px;
  height: 44px;
  width: 100%;
  font-weight: 600;
}

/* =====================
   TABLE
===================== */
.table {
  width: 100%;
  font-size: 13px;
}

.table th {
  font-weight: 600;
  color: #6b7280;
}

/* =====================
   DESKTOP
===================== */
@media (min-width: 992px) {
  .stats {
    grid-template-columns: repeat(3, 1fr);
  }
}
</style>

<div id="page-wrapper">
  <div class="container-fluid">

    <!-- STATS -->
    <div class="stats">
      <div class="card stat-item">
        <span>Total Orders</span>
        <strong>{{ totalorders }}</strong>
      </div>
      <div class="card stat-item">
        <span>You Have Spent</span>
        <strong>{{ user["spent"] }}</strong>
      </div>
      <div class="card stat-item">
        <span>Reseller Program</span>
        <strong>Earn Money</strong>
        <small><a href="/giveaway">Learn more</a></small>
      </div>
    </div>

    <!-- ADD FUNDS -->
    <div class="card">
      <ul class="nav nav-tabs">
        <li class="active"><a data-toggle="tab" href="#addfunds">Add Funds</a></li>
        <li><a data-toggle="tab" href="#history">Funds History</a></li>
      </ul>

      <div class="tab-content" style="margin-top:16px;">
        <!-- ADD FUNDS TAB -->
        <div id="addfunds" class="tab-pane fade in active">
          <form method="post" id="addfundsForm" action="/addfunds" enctype="multipart/form-data">

            <div class="form-group">
              <label>{{ lang['addfunds.method'] }}</label>
              <select id="payment_method" name="payment_type">
                {% for method in site["paymentMethods"] %}
                  <option value="{{ method['id'] }}">{{ method['name'] }}</option>
                {% endfor %}
              </select>
            </div>

            <div id="addfunds_fields"></div>

            <div id="formSubmitResponseMessage"></div>
            <div id="formSubmitResponseContent"></div>

            <button type="submit">Continue</button>
          </form>
        </div>

        <!-- HISTORY TAB -->
        <div id="history" class="tab-pane fade">
          <div class="table-responsive">
            <table class="table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Date</th>
                  <th>Method</th>
                  <th>Amount</th>
                </tr>
              </thead>
              <tbody>
                {% for payment in payments %}
                <tr>
                  <td>{{ payment['id'] }}</td>
                  <td>{{ payment['date'] }}</td>
                  <td>{{ payment['name'] }}</td>
                  <td>{{ payment['amount'] }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
$(document).ready(function() {
    function loadPaymentForm() {
        var selectedMethod = $('#payment_method').val();
        if (selectedMethod) {
            $.ajax({
                url: '/addfunds',
                type: 'POST',
                data: {
                    action: 'getForm',
                    selectedMethod: selectedMethod
                },
                dataType: 'json',
                success: function(response) {
                    if (response.success && response.content) {
                        $('#addfunds_fields').html(response.content);
                    }
                },
                error: function() {
                    $('#addfunds_fields').html('<p style="color:red;">Error loading payment form</p>');
                }
            });
        }
    }
    
    loadPaymentForm();
    
    $('#payment_method').on('change', function() {
        loadPaymentForm();
    });
    
    $('#addfundsForm').on('submit', function(e) {
        e.preventDefault();
        var formData = $(this).serialize();
        
        $.ajax({
            url: '/addfunds',
            type: 'POST',
            data: formData,
            dataType: 'json',
            success: function(response) {
                if (response.success && response.redirect) {
                    window.location.href = response.redirect;
                } else if (response.success && response.message) {
                    $('#formSubmitResponseMessage').html('<div class="alert alert-success">' + response.message + '</div>');
                } else if (response.success === false && response.message) {
                    $('#formSubmitResponseMessage').html('<div class="alert alert-danger">' + response.message + '</div>');
                } else if (response.error) {
                    $('#formSubmitResponseMessage').html('<div class="alert alert-danger">' + response.error + '</div>');
                }
            },
            error: function(xhr) {
                try {
                    var resp = JSON.parse(xhr.responseText);
                    if (resp.error) {
                        $('#formSubmitResponseMessage').html('<div class="alert alert-danger">' + resp.error + '</div>');
                    } else {
                        $('#formSubmitResponseMessage').html('<div class="alert alert-danger">Payment request failed. Please try again.</div>');
                    }
                } catch(e) {
                    $('#formSubmitResponseMessage').html('<div class="alert alert-danger">Payment request failed. Please try again.</div>');
                }
            }
        });
    });
});
</script>

{% include 'footer1.twig' %}
